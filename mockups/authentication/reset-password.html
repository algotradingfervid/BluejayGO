<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Bluejay CMS</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <!-- Component Library -->
    <link rel="stylesheet" href="../../components/main.css">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../../components/tailwind.config.js"></script>
</head>
<body class="login-page">
    <div class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">

        <!-- Reset Password Card -->
        <div class="login-card">

            <!-- Reset Form View -->
            <div id="form-view" class="view active">

                <!-- Logo -->
                <div class="login-logo">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[var(--color-primary)] manual-border flex items-center justify-center">
                            <span class="material-symbols-outlined text-white text-2xl">memory</span>
                        </div>
                        <span class="font-display text-2xl font-extrabold uppercase text-[var(--color-text-primary)]">Bluejay</span>
                    </div>
                </div>

                <!-- Title -->
                <h1 class="login-title">Create New Password</h1>
                <p class="login-subtitle">Min 8 characters with letters, numbers & symbols</p>

                <!-- Form -->
                <form id="reset-form" class="login-form" aria-label="Reset password form" role="form">

                    <!-- New Password Field -->
                    <div class="form-field">
                        <label for="new-password" class="form-label" id="new-password-label">New Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="new-password"
                                name="new-password"
                                class="form-input pr-12"
                                placeholder="Enter new password"
                                aria-labelledby="new-password-label"
                                aria-describedby="new-password-error password-strength"
                                aria-invalid="false"
                                aria-required="true"
                                autocomplete="new-password"
                                required
                            >
                            <button
                                type="button"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)]"
                                aria-label="Show password"
                                aria-pressed="false"
                                onclick="togglePassword('new-password', this)"
                            >
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                        </div>
                        <div id="new-password-error" class="hidden text-[var(--color-error)] font-mono text-xs mt-1 flex items-center gap-1" role="alert" aria-live="polite">
                            <span class="material-symbols-outlined text-sm">warning</span>
                            <span>Password is required</span>
                        </div>

                        <!-- Password Strength Indicator -->
                        <div class="mt-3" id="password-strength">
                            <div class="font-mono text-[10px] uppercase text-[var(--color-text-secondary)] mb-2">Password Strength:</div>
                            <div class="h-2 bg-gray-200 manual-border overflow-hidden">
                                <div class="h-full transition-all duration-300" id="strength-bar" style="width: 0%"></div>
                            </div>
                            <div class="font-mono text-[10px] mt-1" id="strength-text" role="progressbar" aria-label="Password strength" aria-valuenow="0" aria-valuemin="0" aria-valuemax="5"></div>
                        </div>
                    </div>

                    <!-- Confirm Password Field -->
                    <div class="form-field">
                        <label for="confirm-password" class="form-label" id="confirm-password-label">Confirm Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="confirm-password"
                                name="confirm-password"
                                class="form-input pr-12"
                                placeholder="Confirm new password"
                                aria-labelledby="confirm-password-label"
                                aria-describedby="confirm-password-error"
                                aria-invalid="false"
                                aria-required="true"
                                autocomplete="new-password"
                                required
                            >
                            <button
                                type="button"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)]"
                                aria-label="Show password"
                                aria-pressed="false"
                                onclick="togglePassword('confirm-password', this)"
                            >
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                        </div>
                        <div id="confirm-password-error" class="hidden text-[var(--color-error)] font-mono text-xs mt-1 flex items-center gap-1" role="alert" aria-live="polite">
                            <span class="material-symbols-outlined text-sm">warning</span>
                            <span>Passwords do not match</span>
                        </div>
                    </div>

                    <!-- Password Requirements Checklist -->
                    <div class="manual-border p-4 bg-[var(--color-background-light)]">
                        <div class="font-mono text-[10px] font-bold uppercase mb-3 text-[var(--color-text-primary)]">Password Requirements:</div>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2 font-mono text-xs text-[var(--color-text-secondary)]" id="req-length">
                                <span class="material-symbols-outlined text-base text-gray-300">check_circle</span>
                                <span>At least 8 characters</span>
                            </div>
                            <div class="flex items-center gap-2 font-mono text-xs text-[var(--color-text-secondary)]" id="req-uppercase">
                                <span class="material-symbols-outlined text-base text-gray-300">check_circle</span>
                                <span>Contains uppercase letter</span>
                            </div>
                            <div class="flex items-center gap-2 font-mono text-xs text-[var(--color-text-secondary)]" id="req-lowercase">
                                <span class="material-symbols-outlined text-base text-gray-300">check_circle</span>
                                <span>Contains lowercase letter</span>
                            </div>
                            <div class="flex items-center gap-2 font-mono text-xs text-[var(--color-text-secondary)]" id="req-number">
                                <span class="material-symbols-outlined text-base text-gray-300">check_circle</span>
                                <span>Contains a number</span>
                            </div>
                            <div class="flex items-center gap-2 font-mono text-xs text-[var(--color-text-secondary)]" id="req-special">
                                <span class="material-symbols-outlined text-base text-gray-300">check_circle</span>
                                <span>Contains special character</span>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        class="btn btn-primary btn-block"
                        id="submit-btn"
                    >
                        Reset Password
                    </button>

                </form>

            </div>

            <!-- Success View -->
            <div id="success-view" class="view hidden">

                <!-- Logo -->
                <div class="login-logo">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[var(--color-primary)] manual-border flex items-center justify-center">
                            <span class="material-symbols-outlined text-white text-2xl">memory</span>
                        </div>
                        <span class="font-display text-2xl font-extrabold uppercase text-[var(--color-text-primary)]">Bluejay</span>
                    </div>
                </div>

                <!-- Title -->
                <h1 class="login-title">Password Reset Successful!</h1>
                <p class="login-subtitle">You can now sign in with your new password</p>

                <!-- Success Container -->
                <div class="text-center py-8">
                    <div class="w-20 h-20 bg-[rgba(76,175,80,0.1)] manual-border flex items-center justify-center mx-auto mb-6">
                        <span class="material-symbols-outlined text-5xl text-[var(--color-success)]">check_circle</span>
                    </div>

                    <p class="font-mono text-xs text-[var(--color-text-secondary)] mb-4" id="countdown-text">Redirecting to login in <span id="countdown">5</span> seconds...</p>
                </div>

                <!-- Go to Login Button -->
                <a href="login.html" class="btn btn-primary btn-block">
                    Go to Login
                </a>

            </div>

            <!-- Expired Token View -->
            <div id="expired-view" class="view hidden">

                <!-- Logo -->
                <div class="login-logo">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[var(--color-primary)] manual-border flex items-center justify-center">
                            <span class="material-symbols-outlined text-white text-2xl">memory</span>
                        </div>
                        <span class="font-display text-2xl font-extrabold uppercase text-[var(--color-text-primary)]">Bluejay</span>
                    </div>
                </div>

                <!-- Title -->
                <h1 class="login-title">Link Expired</h1>
                <p class="login-subtitle">This reset link is no longer valid</p>

                <!-- Error Container -->
                <div class="text-center py-8">
                    <div class="w-20 h-20 bg-[rgba(229,57,53,0.1)] manual-border flex items-center justify-center mx-auto mb-6">
                        <span class="material-symbols-outlined text-5xl text-[var(--color-error)]">error</span>
                    </div>

                    <p class="font-mono text-xs text-[var(--color-text-secondary)] mb-2">This password reset link has expired or is invalid.</p>
                    <p class="font-mono text-xs text-[var(--color-text-secondary)]">Reset links are valid for 24 hours.</p>
                </div>

                <!-- Buttons -->
                <div class="space-y-3">
                    <a href="forgot-password.html" class="btn btn-primary btn-block">
                        Request New Link
                    </a>
                    <a href="login.html" class="btn btn-secondary btn-block">
                        Back to Login
                    </a>
                </div>

            </div>

        </div>

        <!-- Footer -->
        <footer class="font-mono text-xs text-[var(--color-text-secondary)] text-center mt-8 uppercase">
            &copy; 2026 Bluejay CMS
        </footer>

    </div>

    <!-- JavaScript for interactions -->
    <script>
        // Toggle password visibility
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('.material-symbols-outlined');

            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'visibility_off';
                button.setAttribute('aria-label', 'Hide password');
                button.setAttribute('aria-pressed', 'true');
            } else {
                input.type = 'password';
                icon.textContent = 'visibility';
                button.setAttribute('aria-label', 'Show password');
                button.setAttribute('aria-pressed', 'false');
            }
        }

        // Password strength calculation
        function calculatePasswordStrength(password) {
            let score = 0;
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^a-zA-Z0-9]/.test(password)) score++;
            return Math.min(score, 5);
        }

        // Update password strength indicator
        function updateStrengthIndicator(password) {
            const strengthBar = document.getElementById('strength-bar');
            const strengthText = document.getElementById('strength-text');
            const score = calculatePasswordStrength(password);

            const colors = ['', '#E53935', '#FB8C00', '#FFC107', '#4CAF50', '#2E7D32'];
            const labels = ['', 'Very Weak', 'Weak', 'Fair', 'Strong', 'Very Strong'];
            const widths = ['0%', '20%', '40%', '60%', '80%', '100%'];

            if (score > 0) {
                strengthBar.style.width = widths[score];
                strengthBar.style.backgroundColor = colors[score];
                strengthText.textContent = labels[score];
                strengthText.style.color = colors[score];
            } else {
                strengthBar.style.width = '0%';
                strengthText.textContent = '';
            }

            strengthText.setAttribute('aria-valuenow', score);
        }

        // Update requirements checklist
        function updateRequirements(password) {
            const requirements = {
                'req-length': password.length >= 8,
                'req-uppercase': /[A-Z]/.test(password),
                'req-lowercase': /[a-z]/.test(password),
                'req-number': /[0-9]/.test(password),
                'req-special': /[^a-zA-Z0-9]/.test(password)
            };

            for (const [id, met] of Object.entries(requirements)) {
                const element = document.getElementById(id);
                const icon = element.querySelector('.material-symbols-outlined');
                if (met) {
                    icon.classList.remove('text-gray-300');
                    icon.classList.add('text-[var(--color-success)]');
                    element.classList.remove('text-[var(--color-text-secondary)]');
                    element.classList.add('text-[var(--color-success)]');
                } else {
                    icon.classList.add('text-gray-300');
                    icon.classList.remove('text-[var(--color-success)]');
                    element.classList.add('text-[var(--color-text-secondary)]');
                    element.classList.remove('text-[var(--color-success)]');
                }
            }
        }

        // Password input listener
        document.getElementById('new-password').addEventListener('input', function(e) {
            const password = e.target.value;
            updateStrengthIndicator(password);
            updateRequirements(password);
        });

        // Form validation and submission
        document.getElementById('reset-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const newPassword = document.getElementById('new-password');
            const confirmPassword = document.getElementById('confirm-password');
            const newPasswordError = document.getElementById('new-password-error');
            const confirmPasswordError = document.getElementById('confirm-password-error');
            const submitBtn = document.getElementById('submit-btn');

            let isValid = true;

            // Reset errors
            newPassword.classList.remove('error');
            confirmPassword.classList.remove('error');
            newPasswordError.classList.add('hidden');
            confirmPasswordError.classList.add('hidden');

            // Validate new password
            if (!newPassword.value) {
                newPassword.classList.add('error');
                newPasswordError.querySelector('span:last-child').textContent = 'Password is required';
                newPasswordError.classList.remove('hidden');
                isValid = false;
            } else if (newPassword.value.length < 8) {
                newPassword.classList.add('error');
                newPasswordError.querySelector('span:last-child').textContent = 'Password must be at least 8 characters';
                newPasswordError.classList.remove('hidden');
                isValid = false;
            } else if (calculatePasswordStrength(newPassword.value) < 3) {
                newPassword.classList.add('error');
                newPasswordError.querySelector('span:last-child').textContent = 'Password must include letters, numbers, and symbols';
                newPasswordError.classList.remove('hidden');
                isValid = false;
            }

            // Validate confirm password
            if (!confirmPassword.value) {
                confirmPassword.classList.add('error');
                confirmPasswordError.querySelector('span:last-child').textContent = 'Please confirm your password';
                confirmPasswordError.classList.remove('hidden');
                isValid = false;
            } else if (confirmPassword.value !== newPassword.value) {
                confirmPassword.classList.add('error');
                confirmPasswordError.querySelector('span:last-child').textContent = 'Passwords do not match';
                confirmPasswordError.classList.remove('hidden');
                isValid = false;
            }

            if (isValid) {
                // Show loading state
                submitBtn.classList.add('btn-loading');
                submitBtn.disabled = true;

                // Simulate API call
                setTimeout(function() {
                    // Switch to success view
                    document.getElementById('form-view').classList.add('hidden');
                    document.getElementById('form-view').classList.remove('active');
                    document.getElementById('success-view').classList.remove('hidden');
                    document.getElementById('success-view').classList.add('active');

                    // Start countdown
                    startCountdown();

                    // Reset button state
                    submitBtn.classList.remove('btn-loading');
                    submitBtn.disabled = false;
                }, 2000);
            }
        });

        // Countdown for redirect
        function startCountdown() {
            let count = 5;
            const countdownSpan = document.getElementById('countdown');

            const interval = setInterval(function() {
                count--;
                countdownSpan.textContent = count;

                if (count <= 0) {
                    clearInterval(interval);
                    window.location.href = 'login.html';
                }
            }, 1000);
        }

        // Check URL for token validity simulation
        function checkTokenValidity() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (token === 'expired') {
                document.getElementById('form-view').classList.add('hidden');
                document.getElementById('form-view').classList.remove('active');
                document.getElementById('expired-view').classList.remove('hidden');
                document.getElementById('expired-view').classList.add('active');
            }
        }

        // Run on page load
        checkTokenValidity();
    </script>
</body>
</html>
